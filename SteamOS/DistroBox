# set password if not already done
passwd

# On Konsole
sudo steamos-readonly disable 
sudo pacman-key --init 
sudo pacman-key --populate archlinux 
sudo pacman -Sy 
sudo pacman -S podman
sudo pacman -S fuse-overlayfs
sudo steamos-readonly enable

# RE-DO THIS AT EVERY STEAMOS UPGRADE!

# For External Use:
mkdir -p /run/media/mmcblk0p1/DistroBox/Volumes

On SteamOS Konsole:
curl -s https://raw.githubusercontent.com/89luca89/distrobox/main/install | sh -s -- --prefix /run/media/mmcblk0p1/DistroBox

TO BASHRC:
[ -d /run/media/mmcblk0p1/DistroBox ] && {
  export PATH=/run/media/mmcblk0p1/DistroBox/bin:$PATH
  xhost +si:localuser:$USER
  }
###sudo xhost +?

# Setup subuid/subgid
sudo touch /etc/subuid
sudo touch /etc/subgid
sudo chmod 664 /etc/subuid /etc/subgid

sudo usermod --add-subuids 10000-75535 deck 
sudo usermod --add-subgids 10000-75535 deck

Edit /etc/containers/storage.conf:
[storage.options.overlay] mountopt = "nodev,index=off"
[storage] graphroot = "/run/media/mmcblk0p1/DistroBox/Volumes"
[storage] runroot = "/run/media/mmcblk0p1/DistroBox/Storage"
[storage.options.overlay] mount_program = "/usr/bin/fuse-overlayfs"

# For vanilla:
distrobox create ubuntu --volume /run/media/mmcblk0p1/DistroBox/Volumes --image docker.io/library/ubuntu:22.04 --root
distrobox enter ubuntu --root

# For QEMU KVM support?
distrobox create ubuntu --volume /dev/kvm:/dev/kvm --image docker.io/library/ubuntu:22.04 --root

Check Situation:
virt-host-validate

sudo apt install qemu qemu-kvm qemu-system qemu-guest-agent libvirt-clients libvirt-daemon-system bridge-utils virt-manager ovmf dnsmasq docker.io
sudo service dbus start
libvirtd -d
virt-manager
